describe("Ext.app.bind.Template",function(){var B;function A(F){var E=0;for(var D=F.buffer.length;D-->0;){if(F.buffer[D]){++E}}return E}function C(F){var E=0;for(var D=F.slots.length;D-->0;){if(F.slots[D]){++E}}return E}beforeEach(function(){B=Ext.app.bind.Template});describe("tokens",function(){it("should parse on first use",function(){var D=new B("Hello {foo}");expect(D.tokens).toBe(null);var E=D.getTokens();expect(E).toEqual(["foo"]);expect(A(D)).toBe(1);expect(C(D)).toBe(1)});it("should parse simple names",function(){var D=new B("Hello {foo} {bar}");var E=D.getTokens();expect(E).toEqual(["foo","bar"]);expect(A(D)).toBe(2);expect(C(D)).toBe(2)});it("should parse dotted names",function(){var D=new B("Hello {foo.bar} {bar.foo}");var E=D.getTokens();expect(E).toEqual(["foo.bar","bar.foo"]);expect(A(D)).toBe(2);expect(C(D)).toBe(2)});it("should parse indexes",function(){var D=new B("Hello {1} {0}");var E=D.getTokens();expect(E).toEqual(["1","0"]);expect(A(D)).toBe(2);expect(C(D)).toBe(2)});it("should consolidate tokens",function(){var D=new B("Hello {foo.bar} {bar} {foo.bar} {bar}");var E=D.getTokens();expect(E).toEqual(["foo.bar","bar"]);expect(A(D)).toBe(4);expect(C(D)).toBe(4)});it("should match slots to consolidated tokens",function(){var D=new B("Hello {foo.bar}{bar} - {foo.bar}{bar}");D.parse();expect(A(D)).toBe(2);expect(D.slots[1].pos).toBe(0);expect(D.slots[2].pos).toBe(1);expect(D.slots[4].pos).toBe(0);expect(D.slots[5].pos).toBe(1)})});describe("default formatters",function(){it("should parse",function(){var F=new B("Hello {foo:number} {bar.foo:date}");var G=F.getTokens();expect(G).toEqual(["foo","bar.foo"]);expect(C(F)).toBe(2);var D=0,E;expect(F.buffer[D++]).toBe("Hello ");E=F.slots[D++];expect(E.fmt).toBe("number");expect(E.scope).toBe(Ext.util.Format);expect(F.buffer[D++]).toBe(" ");E=F.slots[D++];expect(E.fmt).toBe("date");expect(E.scope).toBe(Ext.util.Format)});it("should parse arguments",function(){var F=new B('Hello {foo:number(4)} {bar.foo:date(2,"true")}');var G=F.getTokens();expect(G).toEqual(["foo","bar.foo"]);expect(C(F)).toBe(2);var D=0,E;expect(F.buffer[D++]).toBe("Hello ");E=F.slots[D++];expect(E.fmt).toBe("number");expect(E.scope).toBe(Ext.util.Format);expect(E.args.slice(1)).toEqual([4]);expect(F.buffer[D++]).toBe(" ");E=F.slots[D++];expect(E.fmt).toBe("date");expect(E.scope).toBe(Ext.util.Format);expect(E.args.slice(1)).toEqual([2,"true"])});it("should parse boolean arguments",function(){var F=new B("Hello {foo:number(false)} {bar.foo:date(null,true)}");var G=F.getTokens();expect(G).toEqual(["foo","bar.foo"]);expect(C(F)).toBe(2);var D=0,E;expect(F.buffer[D++]).toBe("Hello ");E=F.slots[D++];expect(E.fmt).toBe("number");expect(E.scope).toBe(Ext.util.Format);expect(E.args.slice(1)).toEqual([false]);expect(F.buffer[D++]).toBe(" ");E=F.slots[D++];expect(E.fmt).toBe("date");expect(E.scope).toBe(Ext.util.Format);expect(E.args.slice(1)).toEqual([null,true])});it("should apply simple formatting",function(){var E=new B('Hello {foo:number} {bar.foo:date("Y-m-d")} -- {foo:number("0.00")}');var D=E.apply([123.456,new Date(2013,2,2)]);expect(D).toBe("Hello 123.456 2013-03-02 -- 123.46")});it("should apply complex formatting",function(){var E=new B('Hello {foo:number} {bar.foo:date("Y-m-d")} -- {foo:number("0,000.00")}');var D=E.apply([123456.789,new Date(2013,2,2)]);expect(D).toBe("Hello 123456.789 2013-03-02 -- 123,456.79")})});describe("scoped formatters",function(){it("should parse",function(){var F=new B("Hello {foo:this.number} {bar.foo:this.date}");var G=F.getTokens();expect(G).toEqual(["foo","bar.foo"]);expect(C(F)).toBe(2);var D=0,E;expect(F.buffer[D++]).toBe("Hello ");E=F.slots[D++];expect(E.fmt).toBe("number");expect(E.scope).toBe(undefined);expect(F.buffer[D++]).toBe(" ");E=F.slots[D++];expect(E.fmt).toBe("date");expect(E.scope).toBe(undefined)});it("should parse arguments",function(){var F=new B('Hello {foo:this.number(4)} {bar.foo:this.date(2,"true")}');var G=F.getTokens();expect(G).toEqual(["foo","bar.foo"]);expect(C(F)).toBe(2);var D=0,E;expect(F.buffer[D++]).toBe("Hello ");E=F.slots[D++];expect(E.fmt).toBe("number");expect(E.scope).toBe(undefined);expect(E.args.slice(1)).toEqual([4]);expect(F.buffer[D++]).toBe(" ");E=F.slots[D++];expect(E.fmt).toBe("date");expect(E.scope).toBe(undefined);expect(E.args.slice(1)).toEqual([2,"true"])});it("should apply simple formatting",function(){var E=new B('Hello {foo:number} {bar.foo:date("Y-m-d")} -- {foo:this.number("0.00")}');var D=E.apply([123.456,new Date(2013,2,2)],{scale:2,number:function(F,G){return"[["+Ext.util.Format.number(F*this.scale,G)+"]]"}});expect(D).toBe("Hello 123.456 2013-03-02 -- [[246.91]]")});it("should apply complex formatting",function(){var E=new B('Hello {foo:number} {bar.foo:date("Y-m-d")} -- {foo:this.thing(Ext.versions.core)}');var D=E.apply([123.456,new Date(2013,2,2)],{text:"::",thing:function(F,G){return this.text+F+"="+G+this.text}});expect(D).toBe("Hello 123.456 2013-03-02 -- ::123.456="+Ext.getVersion("core")+"::")})});describe("parseFormat",function(){it("should parse basic formats",function(){var D=B.prototype.parseFormat("round");var E=D.format(3.14);expect(E).toBe(3)});it("should parse formats with basic arguments",function(){var D=B.prototype.parseFormat("round(2)");var E=D.format(3.139);expect(E).toBe(3.14)});it("should parse formats with string arguments",function(){var D=B.prototype.parseFormat('date("Y-m-d")');var E=D.format(new Date(2013,2,2));expect(E).toBe("2013-03-02")})})});