describe("Ext.Template",function(){describe("instantiation",function(){var B;it("it should extend Ext.Base",function(){B=new Ext.Template("");expect(B.superclass).toEqual(Ext.Base.prototype)});describe("configuration options",function(){it("should disableFormats by default",function(){B=new Ext.Template("");expect(B.disableFormats).toBe(false)})});it("should alias apply with applyTemplate",function(){B=new Ext.Template("");spyOn(B,"apply");B.applyTemplate();expect(B.apply).toHaveBeenCalled()});it("should be able to compile immediately",function(){spyOn(Ext.Template.prototype,"compile").andCallThrough();B=new Ext.Template("Hello {foo}",{compiled:true});var C=B.apply({foo:42});expect(C).toBe("Hello 42");expect(Ext.Template.prototype.compile).toHaveBeenCalled()});describe("constructor arguments",function(){describe("objects",function(){it("should apply all object passed after first arguments to configuration",function(){var C={a:1},D={a:2},E={a:3};spyOn(Ext,"apply");B=new Ext.Template("",C,D,E);expect(Ext.apply.calls[1].args).toEqual([B,C]);expect(Ext.apply.calls[3].args).toEqual([B,D]);expect(Ext.apply.calls[5].args).toEqual([B,E])})});describe("strings",function(){it("should concat all strings passed as arguments",function(){var C="a",D="b",E="c";B=new Ext.Template(C,D,E);expect(B.html).toEqual(C+D+E)})});describe("array",function(){it("should concat all array strings",function(){var C=new Ext.Template(["foo","bar","baz"]);expect(C.html).toBe("foobarbaz")});it("should apply an objects after the first argument to the template",function(){var D={a:function(){}},E={b:function(){}};var C=new Ext.Template(["foo","bar",D,E]);expect(C.html).toBe("foobar");expect(C.a).toBe(D.a);expect(C.b).toBe(E.b)})})})});describe("methods",function(){var I,E,D,F,B,G,C,H;beforeEach(function(){B=Ext.fly(document.body).createChild({cls:"foo",children:[{cls:"bar"}]});G=B.first();D=new Ext.Template('<div class="template">Hello {0}.</div>');I=["world"];F=new Ext.Template(['<div name="{id}">','<span class="{cls}">{name} {value:ellipsis(10)}</span>',"</div>"]);E={id:"myid",cls:"myclass",name:"foo",value:"bar"};spyOn(Ext,"getDom").andCallThrough()});afterEach(function(){B.remove()});describe("append",function(){describe("with a simple template",function(){beforeEach(function(){C=D.append(B,["world"],true)});it("should append the new node the end of the specified element",function(){expect(C).toEqual(B.last())});it("should apply the supplied value to the template",function(){expect(C.dom).hasHTML("Hello world.")});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(B)})});describe("with a complex template",function(){beforeEach(function(){H=F.append(B,E,true)});it("should append the new node the end of the specified element",function(){expect(H).toEqual(B.last())});it("should apply the supplied value to the template",function(){expect(H.dom).hasHTML('<span class="myclass">foo bar</span>')});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(B)})})});describe("apply",function(){describe("with a simple template",function(){it("should applies the supplied value an return an HTML fragments",function(){expect(D.apply(I)).toEqual('<div class="template">Hello world.</div>')})});describe("with a complex template",function(){it("should applies the supplied value an return an HTML fragments",function(){expect(F.apply(E)).toEqual('<div name="myid"><span class="myclass">foo bar</span></div>')})})});describe("insertAfter",function(){describe("with a simple template",function(){beforeEach(function(){C=D.insertAfter(G,["world"],true)});it("should insert the new node after the specified element",function(){expect(C).toEqual(G.next())});it("should apply the supplied value to the template",function(){expect(C.dom).hasHTML("Hello world.")});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(G)})});describe("with a complex template",function(){beforeEach(function(){H=F.insertAfter(G,E,true)});it("should insert the new node after the specified element",function(){expect(H).toEqual(G.next())});it("should apply the supplied value to the template",function(){expect(H.dom).hasHTML('<span class="myclass">foo bar</span>')});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(G)})})});describe("insertBefore",function(){describe("with a simple template",function(){beforeEach(function(){C=D.insertBefore(G,["world"],true)});it("should insert the new node before the specified element",function(){expect(C).toEqual(G.prev())});it("should apply the supplied value to the template",function(){expect(C.dom).hasHTML("Hello world.")});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(G)})});describe("with a complex template",function(){beforeEach(function(){H=F.insertBefore(G,E,true)});it("should insert the new node before the specified element",function(){expect(H).toEqual(G.prev())});it("should apply the supplied value to the template",function(){expect(H.dom).hasHTML('<span class="myclass">foo bar</span>')});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(G)})})});describe("insertFirst",function(){describe("with a simple template",function(){beforeEach(function(){C=D.insertFirst(B,["world"],true)});it("should insert the new node as first child of the specified element",function(){expect(C).toEqual(B.first())});it("should apply the supplied value to the template",function(){expect(C.dom).hasHTML("Hello world.")});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(B)})});describe("with a complex template",function(){beforeEach(function(){H=F.insertFirst(B,E,true)});it("should insert the new node as first child of the specified element",function(){expect(H).toEqual(B.first())});it("should apply the supplied value to the template",function(){expect(H.dom).hasHTML('<span class="myclass">foo bar</span>')});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(B)})})});describe("overwrite",function(){describe("with a simple template",function(){beforeEach(function(){C=D.overwrite(B,["world"],true)});it("should overrride the content of the specified element",function(){expect(C).toEqual(B.first());expect(C).toEqual(B.last())});it("should apply the supplied value to the template",function(){expect(C.dom).hasHTML("Hello world.")});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(B)})});describe("with a complex template",function(){beforeEach(function(){H=F.overwrite(B,E,true)});it("should overrride the content of the specified element",function(){expect(H).toEqual(B.first());expect(H).toEqual(B.last())});it("should apply the supplied value to the template",function(){expect(H.dom).hasHTML('<span class="myclass">foo bar</span>')});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(B)})})});describe("overwrite a table element",function(){var J;beforeEach(function(){J=Ext.fly(document.body).createChild({tag:"table"})});afterEach(function(){J.remove()});it("should insert table structure into a table",function(){new Ext.Template("<tr><td>text</td></tr>").overwrite(J);var K=J.dom.innerHTML;if(Ext.isSafari4){expect(K).toEqual("<tr><td>text</td></tr>")}else{expect(K.toLowerCase().replace(/\s/g,"")).toEqual("<tbody><tr><td>text</td></tr></tbody>")}})});describe("set",function(){var J='<div class="template">Good bye {0}.</div>';it("should set the HTML used as the template",function(){D.set(J);expect(D.apply(["world"])).toEqual('<div class="template">Good bye world.</div>')});it("should be able to compile the template",function(){D.set(J,true);var K=D.apply([42]);expect(K).toBe('<div class="template">Good bye 42.</div>');expect(typeof D.fn==="function").toBe(true)})});describe("compile",function(){it("should call compiled function",function(){F.compile();spyOn(F,"fn").andCallThrough();F.apply(E);expect(F.fn).toHaveBeenCalledWith(E)});it("should return the same value as if it wasn't compiled with a complex template",function(){var J,K;J=F.apply(E);F.compile();K=F.apply(E);expect(K).toEqual(J)});it("should return the same value as if it wasn't compiled with a simple template",function(){var J,K;J=D.apply(I);D.compile();K=D.apply(I);expect(K).toEqual(J)});it("should return the template itself",function(){expect(D.compile()).toEqual(D)})})});describe("formats",function(){var C,D,E,B;beforeEach(function(){B={a:"123",b:"456789"};D=spyOn(Ext.util.Format,"ellipsis");E=spyOn(Ext.util.Format,"htmlEncode")});describe("enabled",function(){beforeEach(function(){C=new Ext.Template("{a:ellipsis(2)}","{b:htmlEncode}")});it("should call Ext.util.Format.ellipsis with a non compiled template",function(){C.apply(B);expect(D).toHaveBeenCalledWith(B.a,2);expect(E).toHaveBeenCalledWith(B.b)});it("should call Ext.util.Format.ellipsis with compiled template",function(){C.compile();C.apply(B);expect(D).toHaveBeenCalledWith(B.a,2);expect(E).toHaveBeenCalledWith(B.b)})});describe("disabled",function(){beforeEach(function(){C=new Ext.Template("{a:ellipsis(2)}",{disableFormats:true})});it("should not call Ext.util.Format.ellipsis with a non compiled template",function(){C.apply(B);expect(D).not.toHaveBeenCalled()});it("should not call Ext.util.Format.ellipsis with compiled template",function(){C.compile();C.apply(B);expect(D).not.toHaveBeenCalled()})})});describe("members functions",function(){var C,D,B;beforeEach(function(){D=jasmine.createSpy().andCallFake(function(G,F){return G+F});var E={referenceHolder:true,controller:"foo",fmt:function(){},promote:function(){},items:[{items:[{xtype:"button",reference:"btn",listeners:{click:"promote"},bind:{text:"Promote {user.name:this.fmt}"}}]}]};C=new Ext.Template("{a:this.increment(7)}",{increment:D});B={a:1}});it("should call members functions with a non compiled template",function(){C.apply(B);expect(D).toHaveBeenCalledWith(1,7)});it("should call members functions with a compiled template",function(){C.compile();C.apply(B);expect(D).toHaveBeenCalledWith(1,7)});it("should add member function in initialConfig",function(){expect(C.initialConfig).toEqual({increment:D})})});describe("Ext.Template.from",function(){var C,B;beforeEach(function(){C=Ext.fly(document.body).createChild({tag:"div",html:"FOO {0}."});B=Ext.fly(document.body).createChild({tag:"input"});B.dom.value="BAR {0}."});afterEach(function(){C.remove();B.remove()});it("should create a template with dom element innerHTML",function(){var D=Ext.Template.from(C);expect(D.apply(["BAR"])).toEqual("FOO BAR.")});it("should create a template with dom element value",function(){var D=Ext.Template.from(B);expect(D.apply(["FOO"])).toEqual("BAR FOO.")})});function A(B){describe("Using numeric tokens and a values array",function(){it("should use Ext.util.Format formatting functions by default",function(){expect(new Ext.Template('Value: {0:number("0.00")}',{compiled:B}).apply([3.257])).toBe("Value: 3.26")});it('should use member formatting functions when prepended with "this."',function(){var C=["Warning: {0:this.bold}",{bold:function(D){return"<b>"+D+"</b>"},compiled:B}];expect(new Ext.Template(C).apply(["Warning message"])).toBe("Warning: <b>Warning message</b>")});it('should not see "{margin:0} as a token',function(){expect(new Ext.Template("p{margin:0}body{direction:{0}}",{compiled:B}).apply(["rtl"])).toBe("p{margin:0}body{direction:rtl}")});it('should not see "{1:someText} as a token',function(){expect(new Ext.Template("{0}{1:sometext}{1}",{compiled:B}).apply(["foo","bar"])).toBe("foo{1:sometext}bar")})});describe("Using alphanumeric tokens and a values object",function(){it("should use Ext.util.Format formatting functions by default",function(){expect(new Ext.Template('Value: {prop0:number("0.00")}',{compiled:B}).apply({prop0:3.257})).toBe("Value: 3.26")});it('should use member formatting functions when prepended with "this."',function(){var C=["Warning: {prop0:this.bold}",{bold:function(D){return"<b>"+D+"</b>"},compiled:B}];expect(new Ext.Template(C).apply({prop0:"Warning message"})).toBe("Warning: <b>Warning message</b>")});it('should not see "{margin:0} as a token',function(){expect(new Ext.Template("p{margin:0}body{direction:{prop0}}",{compiled:B}).apply({prop0:"rtl"})).toBe("p{margin:0}body{direction:rtl}")});it('should not see "{1:someText} as a token',function(){expect(new Ext.Template("{prop0}{1:sometext}{prop1}",{compiled:B}).apply({prop0:"foo",prop1:"bar"})).toBe("foo{1:sometext}bar")})})}describe("Non-compiled",function(){A(false)});describe("Compiled",function(){A(true)})});