describe("Ext.ClassManager",function(){var A=Ext.ClassManager,B,C=function(){};beforeEach(function(){A.enableNamespaceParseCache=false;window.My={awesome:{Class:function(){console.log(11)},Class1:function(){console.log(12)},Class2:function(){console.log(13)}},cool:{AnotherClass:function(){console.log(21)},AnotherClass1:function(){console.log(22)},AnotherClass2:function(){console.log(23)}}}});afterEach(function(){try{delete window.Something;delete window.My;delete window.I;delete window.Test}catch(D){window.Something=undefined;window.My=undefined;window.I=undefined;window.Test=undefined}A.enableNamespaceParseCache=true});describe("parseNamespace",function(){it("should return the broken-down namespace",function(){var D=A.parseNamespace("Some.strange.alien.Namespace");expect(D).toEqual([Ext.global,"Some","strange","alien","Namespace"])});it("should return the broken-down namespace with object rewrites",function(){var D=A.parseNamespace("Ext.some.Namespace");expect(D).toEqual([Ext,"some","Namespace"])})});describe("exist",function(){it("should return whether a single class exists",function(){expect(A.isCreated("My.notexisting.Class")).toBe(false);expect(A.isCreated("My.awesome.Class")).toBe(true)})});describe("loader preprocessor",function(){beforeEach(function(){B=function(){}});it("should load and replace string class names with objects",function(){var F={extend:"My.awesome.Class",mixins:{name1:My.cool.AnotherClass,name2:"My.cool.AnotherClass1"}},D={extend:My.awesome.Class,mixins:{name1:My.cool.AnotherClass,name2:My.cool.AnotherClass1}},E;spyOn(Ext.Loader,"require").andCallFake(function(H,G){E=H;G()});Ext.Class.getPreprocessor("loader").fn(B,F,C,C);expect(Ext.Loader.require).toHaveBeenCalled();expect(E).toEqual(["My.awesome.Class","My.cool.AnotherClass1"]);expect(F).toEqual(D)})});describe("create",function(){var G,D,E,H,F;beforeEach(function(){E=A.create("I.am.the.MixinClass1",{config:{mixinConfig:"mixinConfig"},constructor:function(){this.mixinConstructor1Called=true},mixinProperty1:"mixinProperty1",mixinMethod1:function(){this.mixinMethodCalled=true}});H=A.create("I.am.the.MixinClass2",{constructor:function(){this.mixinConstructor2Called=true},mixinProperty2:"mixinProperty2",mixinMethod2:function(){this.mixinMethodCalled=true}});D=A.create("I.am.the.ParentClass",{alias:["parentclass","superclass"],mixins:{mixin1:"I.am.the.MixinClass1"},config:{name:"parentClass",isCool:false,members:{abe:"Abraham Elias",ed:"Ed Spencer"},hobbies:["football","bowling"]},onClassExtended:function(J,K){J.onClassExtendedCalled=true},constructor:function(J){this.initConfig(J);this.parentConstructorCalled=true;this.mixins.mixin1.constructor.apply(this,arguments)},parentProperty:"parentProperty",parentMethod:function(){this.parentMethodCalled=true}});G=A.create("I.am.the.SubClass",{alias:"subclass",extend:"I.am.the.ParentClass",mixins:{mixin1:"I.am.the.MixinClass1",mixin2:"I.am.the.MixinClass2"},config:{name:"subClass",isCool:true,members:{jacky:"Jacky Nguyen",tommy:"Tommy Maintz"},hobbies:["sleeping","eating","movies"],isSpecial:true},constructor:function(){this.subConstrutorCalled=true;this.superclass.constructor.apply(this,arguments);this.mixins.mixin2.constructor.apply(this,arguments)},myOwnMethod:function(){this.myOwnMethodCalled=true}})});it("should create the namespace",function(){expect(I).toBeDefined();expect(I.am).toBeDefined();expect(I.am.the).toBeDefined();expect(I.am.the.SubClass).toBeDefined()});it("should get className",function(){expect(Ext.getClassName(G)).toEqual("I.am.the.SubClass")});describe("addStatics",function(){it("single with name - value arguments",function(){var J=false;G.addStatics({staticMethod:function(){J=true}});expect(G.staticMethod).toBeDefined();G.staticMethod();expect(J).toBeTruthy()});it("multiple with object map argument",function(){G.addStatics({staticProperty:"something",staticMethod:function(){}});expect(G.staticProperty).toEqual("something");expect(G.staticMethod).toBeDefined()})});describe("mixin",function(){it("should have all properties of mixins",function(){var J=new G();expect(J.mixinProperty1).toEqual("mixinProperty1");expect(J.mixinProperty2).toEqual("mixinProperty2");expect(J.mixinMethod1).toBeDefined();expect(J.mixinMethod2).toBeDefined();expect(J.config.mixinConfig).toEqual("mixinConfig")})});describe("config",function(){it("should merge properly",function(){var J=new G();expect(J.config).toEqual({mixinConfig:"mixinConfig",name:"subClass",isCool:true,members:{abe:"Abraham Elias",ed:"Ed Spencer",jacky:"Jacky Nguyen",tommy:"Tommy Maintz"},hobbies:["sleeping","eating","movies"],isSpecial:true})});it("should apply default config",function(){var J=new G();expect(J.getName()).toEqual("subClass");expect(J.getIsCool()).toEqual(true);expect(J.getHobbies()).toEqual(["sleeping","eating","movies"])});it("should apply with supplied config",function(){var J=new G({name:"newName",isCool:false,members:{aaron:"Aaron Conran"}});expect(J.getName()).toEqual("newName");expect(J.getIsCool()).toEqual(false);expect(J.getMembers().aaron).toEqual("Aaron Conran")})});describe("overriden methods",function(){it("should call self constructor",function(){var J=new G();expect(J.subConstrutorCalled).toBeTruthy()});it("should call parent constructor",function(){var J=new G();expect(J.parentConstructorCalled).toBeTruthy()});it("should call mixins constructors",function(){var J=new G();expect(J.mixinConstructor1Called).toBeTruthy();expect(J.mixinConstructor2Called).toBeTruthy()})});describe("alias",function(){it("should store alias",function(){expect(A.getByAlias("subclass")).toBe(G)});it("should store multiple aliases",function(){expect(A.getByAlias("parentclass")).toBe(D);expect(A.getByAlias("superclass")).toBe(D)})})});describe("define",function(){it("should allow anonymous classes",function(){var E=Ext.define(null,function(F){return{constructor:function(){this.foo=1;this.T=F}}});var D=new E();expect(D.foo).toBe(1);expect(E).toBe(D.self);expect(D.T).toBe(E);expect(D.$className).toBeNull()})});describe("instantiate",function(){beforeEach(function(){A.create("Test.stuff.Person",{alias:"person",constructor:function(E,D,F){this.name=E;this.age=D;this.sex=F},eat:function(D){this.eatenFood=D}});A.create("Test.stuff.Developer",{alias:"developer",extend:"Test.stuff.Person",constructor:function(D,F,E,G){this.isGeek=D;return this.superclass.constructor.apply(this,arguments)},code:function(D){this.languageCoded=D;this.eat("bugs")}})});it("should create the instance by full class name",function(){var D=Ext.create("Test.stuff.Person","Jacky",24,"male");expect(D instanceof Test.stuff.Person).toBe(true)});it("should create the instance by alias",function(){var D=A.instantiateByAlias("person","Jacky",24,"male");expect(D instanceof Test.stuff.Person).toBe(true)});it("should pass all arguments to the constructor",function(){var D=A.instantiateByAlias("person","Jacky",24,"male");expect(D.name).toBe("Jacky");expect(D.age).toBe(24);expect(D.sex).toBe("male")});it("should have all methods in prototype",function(){var D=A.instantiateByAlias("person","Jacky",24,"male");D.eat("rice");expect(D.eatenFood).toBe("rice")});it("should works with inheritance",function(){var D=A.instantiateByAlias("developer",true,"Jacky",24,"male");D.code("javascript");expect(D.languageCoded).toBe("javascript");expect(D.eatenFood).toBe("bugs")})});describe("post-processors",function(){xdescribe("uses",function(){});describe("singleton",function(){it("should create the instance namespace and return the class",function(){var D=Ext.define("Something.Cool",{singleton:true,someMethod:function(){this.someMethodCalled=true},someProperty:"something"});expect(Something.Cool).toBeDefined();expect(Something.Cool instanceof D).toBeTruthy()})});describe("alias xtype",function(){it("should set xtype as a static class property",function(){var D=Ext.define("Something.Cool",{alias:"widget.cool"});expect(Something.Cool.xtype).toEqual("cool")})});describe("alternate",function(){it("should create the alternate with a string for alternateClassName property",function(){Ext.define("Something.Cool",{alternateClassName:"Something.CoolAsWell",someMethod:function(){this.someMethodCalled=true},someProperty:"something"});expect(Something.CoolAsWell).toBeDefined();expect(Something.CoolAsWell).toBe(Something.Cool)});it("should create the alternate with an array for alternateClassName property",function(){Ext.define("Something.Cool",{alternateClassName:["Something.CoolAsWell","Something.AlsoCool"]});expect(Something.CoolAsWell).toBe(Something.Cool);expect(Something.AlsoCool).toBe(Something.Cool)})})});describe("createNamespaces",function(){var D=window;it("should have an alias Ext.namespace",function(){spyOn(Ext.ClassManager,"createNamespaces");Ext.namespace("a","b","c");expect(Ext.ClassManager.createNamespaces).toHaveBeenCalledWith("a","b","c")});it("should create a single top level namespace",function(){Ext.ClassManager.createNamespaces("FooTest1");expect(D.FooTest1).toBeDefined();if(Ext.isIE8){D.FooTest1=undefined}else{delete D.FooTest1}});it("should create multiple top level namespace",function(){Ext.ClassManager.createNamespaces("FooTest2","FooTest3","FooTest4");expect(D.FooTest2).toBeDefined();expect(D.FooTest3).toBeDefined();expect(D.FooTest4).toBeDefined();if(Ext.isIE8){D.FooTest2=undefined;D.FooTest3=undefined;D.FooTest4=undefined}else{delete D.FooTest2;delete D.FooTest3;delete D.FooTest4}});it("should create a chain of namespaces, starting from a top level",function(){Ext.ClassManager.createNamespaces("FooTest5","FooTest5.ns1","FooTest5.ns1.ns2","FooTest5.ns1.ns2.ns3");expect(D.FooTest5).toBeDefined();expect(D.FooTest5.ns1).toBeDefined();expect(D.FooTest5.ns1.ns2).toBeDefined();expect(D.FooTest5.ns1.ns2.ns3).toBeDefined();if(Ext.isIE8){D.FooTest5=undefined}else{delete D.FooTest5}});it("should create lower level namespaces without first defining the top level",function(){Ext.ClassManager.createNamespaces("FooTest6.ns1","FooTest7.ns2");expect(D.FooTest6).toBeDefined();expect(D.FooTest6.ns1).toBeDefined();expect(D.FooTest7).toBeDefined();expect(D.FooTest7.ns2).toBeDefined();if(Ext.isIE8){D.FooTest6=undefined;D.FooTest7=undefined}else{delete D.FooTest6;delete D.FooTest7}});it("should create a lower level namespace without defining the middle level",function(){Ext.ClassManager.createNamespaces("FooTest8","FooTest8.ns1.ns2");expect(D.FooTest8).toBeDefined();expect(D.FooTest8.ns1).toBeDefined();expect(D.FooTest8.ns1.ns2).toBeDefined();if(Ext.isIE8){D.FooTest8=undefined}else{delete D.FooTest8}});it("should not overwritte existing namespace",function(){Ext.ClassManager.createNamespaces("FooTest9");FooTest9.prop1="foo";Ext.ClassManager.createNamespaces("FooTest9");expect(FooTest9.prop1).toEqual("foo");if(Ext.isIE8){D.FooTest9=undefined}else{delete D.FooTest9}})})});