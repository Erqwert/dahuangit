(Ext.supports.Touch?describe:xdescribe)("Ext.event.gesture.Pinch",function(){var M=Ext.testHelper,N,A,C,K,D,F,E,J,I;function L(Q){M.touchStart(N,Q)}function B(Q){M.touchMove(N,Q)}function P(Q){M.touchEnd(N,Q)}function G(Q){M.touchCancel(N,Q)}function O(Q,S){var R;for(R in S){expect(Q[R]).toBe(S[R])}}function H(S,T,Q,R){return new Ext.util.Point(S,T).getDistanceTo({x:Q,y:R})}beforeEach(function(){N=Ext.getBody().createChild({});A=jasmine.createSpy();C=jasmine.createSpy();K=jasmine.createSpy();D=jasmine.createSpy();A.andCallFake(function(Q){F=Q});C.andCallFake(function(Q){E=Q});K.andCallFake(function(Q){J=Q});D.andCallFake(function(Q){J=Q});N.on("pinchstart",A);N.on("pinch",C);N.on("pinchend",K);N.on("pinchcancel",D)});afterEach(function(){N.destroy()});it("should fire pinchstart, pinch, and pinchend",function(){var R,Q;runs(function(){L({id:1,x:100,y:102});L({id:2,x:200,y:198});B({id:1,x:105,y:103})});waitsForAnimation();runs(function(){expect(A).toHaveBeenCalled();Q=R=H(105,103,200,198);expect(F.distance).toBe(R);expect(F.scale).toBe(1);B({id:2,x:195,y:190})});waitsForAnimation();runs(function(){R=H(105,103,195,190);expect(C.callCount).toBe(1);expect(E.distance).toBe(R);expect(E.scale).toBe(R/Q);B({id:1,x:125,y:133})});waitsForAnimation();runs(function(){R=H(125,133,195,190);expect(C.callCount).toBe(2);expect(E.distance).toBe(R);expect(E.scale).toBe(R/Q);P({id:1,x:125,y:133});P({id:2,x:195,y:190})});waitsForAnimation();runs(function(){expect(K).toHaveBeenCalled()})});if(Ext.supports.Touch){it("should fire pinchcancel and not pinchend if the first touch is canceled",function(){var R,Q;runs(function(){L({id:1,x:100,y:102});L({id:2,x:200,y:198});B({id:1,x:105,y:103})});waitsForAnimation();runs(function(){expect(A).toHaveBeenCalled();Q=R=H(105,103,200,198);expect(F.distance).toBe(R);expect(F.scale).toBe(1);B({id:2,x:195,y:190})});waitsForAnimation();runs(function(){R=H(105,103,195,190);expect(C.callCount).toBe(1);expect(E.distance).toBe(R);expect(E.scale).toBe(R/Q);G({id:1,x:125,y:133});P({id:2,x:195,y:190})});waitsForAnimation();runs(function(){expect(D).toHaveBeenCalled();expect(K).not.toHaveBeenCalled()})});it("should fire pinchcancel if the second touch is canceled",function(){var R,Q;runs(function(){L({id:1,x:100,y:102});L({id:2,x:200,y:198});B({id:1,x:105,y:103})});waitsForAnimation();runs(function(){expect(A).toHaveBeenCalled();Q=R=H(105,103,200,198);expect(F.distance).toBe(R);expect(F.scale).toBe(1);B({id:2,x:195,y:190})});waitsForAnimation();runs(function(){R=H(105,103,195,190);expect(C.callCount).toBe(1);expect(E.distance).toBe(R);expect(E.scale).toBe(R/Q);G({id:2,x:195,y:190});P({id:1,x:125,y:133})});waitsForAnimation();runs(function(){expect(D).toHaveBeenCalled();expect(K).not.toHaveBeenCalled()})})}});