describe("Ext.util.LocalStorage",function(){var A;function B(){return new Ext.util.LocalStorage({id:"one",flushDelay:0})}beforeEach(function(){A=B()});afterEach(function(){A.clear();A.destroy();A=null});describe("initialization",function(){it("should start empty",function(){var C=A.getKeys();expect(C.length).toBe(0)});it("should start with last state",function(){A.setItem("foo","bar");A.destroy();A=B();var C=A.getKeys();expect(C.length).toBe(1);expect(C[0]).toBe("foo")})});describe("isolation",function(){var D;function C(){return new Ext.util.LocalStorage({id:"two",flushDelay:0})}beforeEach(function(){D=C()});afterEach(function(){D.clear();D.destroy();D=null});it("should isolate getKeys",function(){A.setItem("foo","bar");D.setItem("foo","42");var G=A.getKeys();expect(G.length).toBe(1);expect(G[0]).toBe("foo");var H=D.getKeys();expect(H.length).toBe(1);expect(H[0]).toBe("foo");expect(G).not.toBe(H);var E=A.getItem("foo");var F=D.getItem("foo");expect(E).toBe("bar");expect(F).toBe("42")});it("should isolate keys",function(){A.setItem("foo","bar");A.setItem("bar","foobar");D.setItem("foo","42");D.setItem("zip","abc");D.setItem("zap","xyz");var I=[A.key(0),A.key(1)];I.sort();expect(I[1]).toBe("foo");expect(I[0]).toBe("bar");expect(A.key(2)).toBe(null);var K=[D.key(0),D.key(1),D.key(2)];K.sort();expect(K[0]).toBe("foo");expect(K[1]).toBe("zap");expect(K[2]).toBe("zip");expect(D.key(3)).toBe(null);var F=A.getItem("foo");expect(F).toBe("bar");var G=A.getItem("bar");expect(G).toBe("foobar");var H=D.getItem("foo");expect(H).toBe("42");var J=D.getItem("zip");expect(J).toBe("abc");var E=D.getItem("zap");expect(E).toBe("xyz")});it("should isolate clear",function(){A.setItem("foo","bar");D.setItem("foo","42");A.clear();var F=A.getKeys();expect(F.length).toBe(0);var E=D.getItem("foo");var G=D.getKeys();expect(G.length).toBe(1);expect(E).toBe("42")});it("should isolate removeItem",function(){A.setItem("foo","bar");D.setItem("foo","42");A.removeItem("foo");var F=A.getKeys();expect(F.length).toBe(0);var E=D.getItem("foo");var G=D.getKeys();expect(G.length).toBe(1);expect(E).toBe("42")})});describe("cache",function(){it("should not share instances with the different id",function(){var C=Ext.util.LocalStorage.get("foo");var D=Ext.util.LocalStorage.get("bar");expect(C).not.toBe(D);C.release();D.release()});it("should share instances with the same id",function(){var C=Ext.util.LocalStorage.get("foo");var D=Ext.util.LocalStorage.get("foo");expect(C).toBe(D);C.release();D.release()});it("should destroy the instance on final release",function(){var C=Ext.util.LocalStorage.get("foo");expect(C._users).toBe(1);expect(C).toBe(Ext.util.LocalStorage.get("foo"));expect(C._users).toBe(2);C.release();expect(C._users).toBe(1);expect(C.destroyed).toBe(false);C.release();expect(C._users).toBe(0);expect(C.destroyed).toBe(true)})});describe("delayed operation",function(){var D;function C(){return new Ext.util.LocalStorage({id:"three",flushDelay:1})}beforeEach(function(){D=C()});afterEach(function(){D.clear();D.destroy();D=null});it("should delay writes",function(){if(D.el){runs(function(){D.setItem("foo","42");var E=D.el.getAttribute("xdata")||"{}";expect(E).toBe("{}")});waitsFor(function(){return !D._timer});runs(function(){var E=D.el.getAttribute("xdata");expect(E).toBe('{"foo":"42"}')})}});it("should flush writes when requested",function(){if(D.el){D.setItem("foo","42");var E=D.el.getAttribute("xdata")||"{}";expect(E).toBe("{}");expect(D._timer).not.toBe(null);D.save();expect(D._timer).toBe(null);var F=D.el.getAttribute("xdata");expect(F).toBe('{"foo":"42"}')}})})});