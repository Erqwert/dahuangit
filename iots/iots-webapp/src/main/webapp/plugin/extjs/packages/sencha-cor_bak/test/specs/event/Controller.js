describe("Ext.event.Controller",function(){describe("members",function(){var E,A,B,D,C;beforeEach(function(){E=new Ext.event.Controller(Ext.event.Dispatcher.getInstance());A=new Ext.event.ListenerStack();E.setListenerStacks([A]);B=function(){},D=null,C={}});describe("fire()",function(){it("should execute all listeners in the correct order",function(){var F,H,G=0,I=function(){F=++G},J=function(){H=++G};A.add(I);A.add(J);E.fire();expect(F).toBe(1);expect(H).toBe(2)});it("should create a buffered callback if buffer option is provided",function(){var F=jasmine.createSpy();spyOn(Ext.Function,"createBuffered").andReturn(F);A.add(B,D,{buffer:500});E.fire();expect(Ext.Function.createBuffered).toHaveBeenCalledWith(B,500,D);expect(F).toHaveBeenCalled()});it("should create a delayed callback if delay option is provided",function(){var F=jasmine.createSpy();spyOn(Ext.Function,"createDelayed").andReturn(F);A.add(B,D,{delay:500});E.fire();expect(Ext.Function.createDelayed).toHaveBeenCalledWith(B,500,D);expect(F).toHaveBeenCalled()});it("should pass arguments to the listeners, last argument must always be the reference to the controller object",function(){var I,J,H,F,L=["just","testing",123,[],{}],K=function(){I=Ext.Array.toArray(arguments);H=I.pop()},G=function(){J=Ext.Array.toArray(arguments);F=J.pop()};A.add(K,D,C);A.add(G,D,C);E.fire(L);expect(I).toEqual(L.concat([C]));expect(J).toEqual(L.concat([C]));expect(H).toBe(E);expect(F).toBe(E)});describe("options.args",function(){it("should prepend the args option to the firing arguments",function(){var F=jasmine.createSpy(),G={args:[1,2,3]};A.add(F,{},G);E.fire();expect(F).toHaveBeenCalledWith(1,2,3,G,E)})});describe("pause(), resume() and stop()",function(){it("should pause listeners invocation",function(){runs(function(){this.totalCalled=0;var H=this,I=function(){H.oneCalled=true;H.totalCalled++},F=function(K,J){H.twoCalled=true;H.totalCalled++;J.pause();setTimeout(function(){J.resume()},100)},G=function(){H.totalCalled++;H.threeCalled=true};A.add(I);A.add(F);A.add(G);E.fire();expect(this.oneCalled).toBe(true);expect(this.twoCalled).toBe(true);expect(this.threeCalled).toBeFalsy();expect(this.totalCalled).toBe(2)})});it("should pause listeners invocation, then resume asynchronously",function(){runs(function(){this.totalCalled=0;var H=this,I=function(){H.oneCalled=true;H.totalCalled++},F=function(K,J){H.twoCalled=true;H.totalCalled++;J.pause();setTimeout(function(){J.resume()},100)},G=function(){H.totalCalled++;H.threeCalled=true};A.add(I);A.add(F);A.add(G);E.fire();expect(this.oneCalled).toBe(true);expect(this.twoCalled).toBe(true);expect(this.threeCalled).toBeFalsy();expect(this.totalCalled).toBe(2)});waitsFor(function(){return this.threeCalled},"Third function is never called",300);runs(function(){expect(this.totalCalled).toBe(3)})});it("should stop listeners invocation",function(){this.totalCalled=0;var H=this,I=function(){H.oneCalled=true;H.totalCalled++},F=function(K,J){H.twoCalled=true;H.totalCalled++;J.stop()},G=function(){H.totalCalled++;H.threeCalled=true};A.add(I);A.add(F);A.add(G);E.fire();expect(this.oneCalled).toBe(true);expect(this.twoCalled).toBe(true);expect(this.threeCalled).toBeFalsy();expect(this.totalCalled).toBe(2);E.resume();expect(this.totalCalled).toBe(2)})})})})});